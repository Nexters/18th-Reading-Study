# 역할, 책임, 협력

객체 지향에서 가장 중요한 것은 혁할, 책임, 협력이다.

## 협력

### 영화 예매 시스템 돌아보기

- 협력
    - 객체들이 기능 구현을 위해 수행하는 상호작용
- 책임
    - 객체가 협력에 참여하기 위해 수행하는 롲기
- 역할
    - 협력 안에서 객체가 수행하는 책임을 모은 것

### 협력

- 메시지 전송
    - 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단
- 메시지를 수신한 객체는 메서드를 실행해 요청에 응답한다.
    - 외부 객체는 오직 메시지만 전송할 수 있다.
    - 메시지를 어떻게 처리할지는 수신한 객체가 직접 결정한다.

Screening이 Movie를 직접 참조해 요금을 계산하면 Movie는 수동적인 존재가 되며 내부 구현에 직접 접근하면서 캡슐화를 깨게 된다.

### 협력이 설계를 위한 문맥을 결정한다

- 협력이 객체의 행동을 결정한다.
    - 협력이 바뀌면 객체가 제공하는 행동도 바뀐다.

Movie라는 단어는 일반적으로 영화를 상영하는 것을 상상하므로 play()같은 행동을 예상할 것이다. 하지만 이 프로젝트에서는 영화 예매를 위한 협력을 하고 있으므로 이 협력이 Movie의 행동을 결정한다.

- 행동이 객체의 상태를 결정한다.
    - 객체가 행동을 수행할 때 필요로 하는 정보를 함께 가지고 있어야 한다.

Movie가 fee와 discountPolicy를 가지고 있는 이유는 요금 게산이라는 행동을 할 때 이 정보가 필요하기 때문이다.

- 협력은 객체를 설계하는 데 필요한 일종의 문맥을 제공한다.
    - 객체가 참여하는 협력이 객체를 구성하는 행동과 상태를 결정한다.

## 책임

### 책임이란 무엇인가

- 협력
    - 협력에 참여하기 위해 객체가 수행하는 행동

객체의 책임은 하는 것과 아는 것으로 나눌 수 있다.

- 하는 것
    - 객체를 생성하거나 계산을 수행하는 등 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것
    - 사적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

Screening은 영화 예매라는 책임을 가지고 있고 따라서 자신이 상영할 영화를 알고 있어야 한다. 즉, 아는 것과 관련된 책임을 가지고 있어야 한다.

객체는 자신의 책임을 수행하는 데 필요한 정보를 알고 있을 책임과 자신이 할 수 없는 작업을 도와줄 객체를 알고 있을 책임이 있다.

### 책임 할당

- 정보 전문가 패턴
    - 협력에 필요한 지식과 방법을 가장 잘 알고 있는 객체에게 도움을 청한다.
- 객체 지향 설계는 협력에 필요한 메시지를 찾고 메시지에 적절한 객체를 선택하는 반복을 통해 이뤄진다.
    - 결졍된 메시지는 객체의 퍼블릭 인터페이스를 구성한다.

`예매하라`라는 메시지를 처리하려면 영화 예매와 관련된 정보를 가장 많이 알고 있는 Screening에게 책임을 할당한다. 예매 가격을 계산하기 위해 Screening은 가격 계산을 잘 알고 있는 Movie를
선택한다.

### 책임 주도 설계

- 책임을 찾고 책임을 수행할 적절한 객체를 찾아 할당하는 방식으로 협력을 설계하는 방법

설계 과정은 다음과 같다.

1. 시스템이 사용자에게 제공해야 하는 기능 즉, 책임을 파악한다.
2. 시스템 책임을 더 작은 책임으로 분할한다.
3. 분할된 책임을 수행할 수 있는 적절한 객체, 역할을 찾아 책임을 할당한다.
4. 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체, 역할을 찾는다.
5. 해당 객체, 역할에게 책임을 할당해 협력하게 한다.

### 메시지가 객체를 결정한다

책임을 할당하는 데 필요한 메시지를 먼저 선택하고 메시지 처리할 객체는 나중에 선택한다. 즉, 메시지를 선택하는 것은 객체가 아니라 메시지다. 메시지가 객체를 선택하게 하는 데에는 두 가지 이유가 있다.

- 객체가 최소한의 인터페이스를 가진다.
    - 필요한 메시지가 식별될 때까지 객체 퍼블릭 인터페이스에 어떤 것도 추가하지 않는다.
- 객체가 추상적인 인터페이스를 가질 수 있게 된다.
    - 인터페이스가 무엇을 해야하는지는 표현하지만 어떻게 수행하는지는 노출하지 않게 된다.

### 행동이 상태를 결정한다

- 객체는 협력에 참여하기 위해 존재한다.
    - 협력에 필요한 행동을 제공해야 한다. 상태가 아니다.
    - 상태에 초점을 맞추면 구현이 인터페이스에 노출되어 캡슐화가 저해된다.
    - 상태는 단지 객체가 행동을 수행하기 위한 재료일 뿐이다.

## 역할

### 역할과 협력

- 객체가 협력 안에서 수행하는 책임의 집합

`예매하라` 메시지를 처리하기 위해 Screening을 선택한것은 두 가지 단계로 나눌 수 있다. 영화 예매를 할 수 있는 적절한 역할을 찾고, 역할을 수행할 객체로 Screening 인스턴스를 선택한다.

역할에 어떤 이름을 붙인 것은 아니지만 역할을 찾고 그 역할을 수행할 객체를 선택하는 과정으로 진행된 것이다.

### 유연하고 재사용 가능한 협력

- 역할이라는 개념ㅇ르 사용하면 유연하고 재사용 가능한 협력을 얻을 수 있다.

Movie가 할인 정책을 적용하기 위해 AmountDiscountPolicy와 PercentDiscountPolicy에 대해 협력 관계를 개별적으로 작성하면 번거롭고 대부분이 중복된다. 그래서 할인 요금 계산이라는
책임을 수행할 DiscountPolicy 역할로 추상화해서 대체할 수 있다.

- 역할의 구현
    - 추상 클래스와 인터페이스로 역할을 구현한다.
    - 추상 클래스는 책임의 일부가 구현되어있고 인터페이스는 구현 없이 책임만 나열한다.
    - 하지만 공통적으로 다양한 종류의 객체를 캡슐화하는 추상화를 수행한다.

### 객체 대 역할

오직 한 종류의 객체만 협력에 참여하는 상황에서는 굳이 역할이라기 보다는 객체로 간주해도 된다. 여러 종류의 객체가 참여한다면 역할이라고 부르면 된다.

설계 초반에는 적절한 책임과 협력의 큰 그림을 그리는 것이 중요하다. 역할과 객체를 명확히 구분하는 것은 그렇게 중요하지 않다.

### 역할과 추상화

- 추상화를 사용하면 세부 사항을 생략하고 핵심 개념을 강조할 수 있다.
    - AmountDiscountPolicy 등을 알 필요 없이 할인 정책이라는 구조를 이해할 수 있다.
- 추상화를 사용하면 설계를 유연하게 만들 수 있다.
    - 역할은 다양한 종류의 객체를 끼워놓을 수 있는 슬롯이다.
    - 상황에 따라 객체를 서로 대체할 수 있어 협력이 유연해진다.
  
### 배우와 배역

- 한 배역을 여러 배우가 연기할 수 있다.
  - 동일한 역할에 하나 이상의 객체가 존재할 수 있다. 즉, 대체할 수 있다.