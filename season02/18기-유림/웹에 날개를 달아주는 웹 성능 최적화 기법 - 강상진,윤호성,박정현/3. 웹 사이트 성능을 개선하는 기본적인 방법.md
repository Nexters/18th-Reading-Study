> p65-90

### 3. 웹 사이트 성능을 개선하는 기본적인 방법

**HTTP 요청 수 줄이기**

웹 사이트를 단순하게 제작하는 것이 HTTP 프로토콜 요청 수를 줄이는 가장 쉬운 방법이다. 하지만 웹 성능을 위해 나타낼 콘텐츠를 줄이는 것이 현실적으로 적절한 방법은 아니다. 콘텐츠는 동일하지만 HTTP 요청 수를 줄이는 방법을 찾아야 한다.



**스크립트 파일 병합**

소프트웨어 공학에서는 분업화와 유지보수를 위해 최소 기능 단위별로 모듈화를 제안한다. 아이러니하게도 (정복과 분할) 모듈화는 HTTP 요청 수를 증가시키므로 웹 성능에 부정적인 영향을 미친다.

스크립트 파일을 병합하면 파일 호출이 줄어든다. 그러나 합쳐진 파일의 크기가 너무 크다면 그 파일의 로딩 과정이 길어질 수 있으므로 적절한 크기를 유지한다.



**인라인 이미지**

HTML 파일의 CSS 안에 해시 정보를 통해 웹 페이지 배경 이미지 파일을 삽입한다. HTML 파일의 바이트 크기가 소폭 커지지만 이미지 파일 호출보다 전체 로딩 시간이 단축된다.

별도의 이미지 파일이 존재하지 않아 인터넷이나 브라우저에 캐시할 수 없고, HTML 캐시 시 동시에 캐시 가능. 때문에 전반적인 성능 개선 여부를 확인하고 사용해야 한다.



**CSS 스프라이트**

여러 개의 이미지를 하나의 이미지 파일로 결합해 필요한 이미지가 위치하는 픽셀 좌표 정보를 사용.

```css
background: url('imgs/sprites_image.png')
```



**스크립트 파일 압축 전달**

각 웹 서버가 지원하는 방식으로 스크립트를 압축해 보내고 압축을 풀어 사용하면 속도가 더 빨라질 수 있다.

```javascript
// 클라이언트 요청 헤더 - 브라우저는 gzip, deflate, sdch 지원
Accept-Encoding: gzip, deflate, sdch

// 웹 서버 응답 헤더 - 지원하는 방식 중 gzip 사용할 것을 명시
Content-Encoding: gzip
```



**스크립트 파일 최소화**

주석문, 공백, 개행 문자 등 실제 로직에 영향을 주지 않는 부분을 제거하여 파일 크기를 줄인다. 그렇지만 이 경우 로직 변경과 디버깅이 불가능할 수 있다.

따라서 개발 서버와 운영 서버를 분리하는 방법을 많이 이용한다. 이는 개발 서버에서 스크립트 원본 파일을 개발하고, 테스트가 완료되면 스크립트를 최소화해 운영 서버로 이관하여 운영 시에만 최소화된 스크립트 파일을 사용한다.

최소화 후 gzip 등의 압축 방식까지 적용하면 베스트!

https://www.minifier.org



**이미지 파일 압축**

이미지 파일은 해당 파일 정보를 메타 데이터에 포함해 저장한다. 이 불필요한(?) 부분을 제거하면 크기를 상당히 줄일 수 있다.

https://tinypng.com



**큰 파일은 작게 나누어 전송**

큰 파일의 일부분을 순서대로 다운로드하는 부분 요청 응답 방식. 동영상, 고화질 이미지, 매우 긴 문서, 게임 패치 파일, 실시간 생성 및 갱신되는 크기를 가늠할 수 없는 콘텐츠에 유용.

```
// 웹 서버의 부분 응답 지원 여부 확인
curl -I http://www.example.com/bigfile.jpb

Accept-Ranges: bytes  // bytes 단위로 부분 지원 기능을 수락
Content-Length: 50000000  // 전체 크기가 50MB

// 파일의 특정 부분 요청하기
curl -v http://www.example.com/bigfile.jpg -H "Range: bytes=0-1023"
```



**캐시 최적화하기**

일반적으로 시스템이 캐시 저장소에 접근하는 시간이 원래 데이터 위치에 접근하는 시간보다 짧고, 시스템의 리소스를 아낄 수 있는 점에 착안해 콘텐츠를 다시 받아오는 시간을 절약하고 싶을 때 캐시를 사용.

본래 캐시는 컴퓨터 자원을 절약하려는 방법에서 시작하였다. 대용량 메인 메모리에 빠르게 접근하는 CPU 캐시나 자주 사용하는 콘텐츠를 미리 하드 디스크에 저장해두는 디스크 캐시 등은 컴퓨터 자원을 적게 사용하면서 반복 사용되는 명령에 빠르게 응답하기 위해 만들어졌다.

인터넷상에서 캐시는 ISP 회사가 지역에 분포된 특정 시스템에 사용자와 원격 시스템 사이에서 주고받은 데이터를 캐시하고 다음 사용자에게 제공하는 방식으로 널리 사용된다. 콘텐츠를 캐시하는 이 시스템을 프록시 서버라고 부른다. 프록시 서버 덕분에 ISP 회사들은 네트워크 대역폭을 아낄 수 있다. 소비자들은 빠르게 콘텐츠 응답을 받을 수 있다.



**인터넷 캐시**

프록시 서버는 클라이언트가 처음 요청한 콘텐츠를 원본 서버에 대신 요청하여 클라이언트에게 전달해주고 이를 스스로 저장한다. 이후 다른 클라이언트가 동일한 콘텐츠를 요청했을 때 원본 서버에 접속할 필요 없이 자체 저장한 콘텐츠를 제공한다.



**브라우저 캐시**

클라이언트 위치의 캐시이다. 웹 콘텐츠들 중 브라우저가 저장할 수 있는 콘텐츠들을 저장해 더이상 요청하지 않는다.

특정 콘텐츠를 브라우저에서 캐시할 수 있게 하고, 얼마나 긴 시간 동안 캐시해도 되는지 정책이 결정되면 웹 서버는 다음과 같이 Cache-Control 응답 헤더를 통해 설정 내용을 클라이언트에게 전달한다. Cache-Control 헤더에는 캐시 기간을 초로 표시하여 브라우저에 전달한다. 이 기간을 캐시가 생존하는 시간이라는 의미에서 TTL(Time To Live)이라고도 한다.



**CDN**

