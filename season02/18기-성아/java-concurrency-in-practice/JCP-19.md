병렬 프로그램은 순차적인 프로그램과 유사한 디자인 패턴을 사용한다. 테스트 방법도 유사하다. 차이점은 결과 값의 범위가 다양하고 문제가 발생할 확률이 순차적인 프로그램보다 적다는 점이다. 따라서 테스트 시간이 길어진다.  개인적인 생각으로는 단위 테스트보다는 통합 테스트에 가깝게 테스트할 수 밖에 없는 것 같다.

병렬 테스트는 크게 두 가지 결과로 분류할 수 있다. 안전성과 활동성이다. 안전성 테스트는 설계한대로 동작하는 지 확인하는 테스트이다. 활동성 테스트는 최대 얼마나 많이, 빠르게 처리할 수 있는지 확인하는 테스트이다. 안전성 테스트는 병렬 프로그램에서는 문제가 나타나는 확률이 낮다는 특성 때문에 테스트하기 어렵다. 활동량 테스트를 나타내는 지표는 세 가지가 있다. "병렬로 실행하는 여러 개의 작업이 각자 할 일을 끝내는 속도"를 나타내는 처리량 (throughput), "요청이 들어오고 응답을 줄 때 까지 걸리는 시간"을 의미하는 응답성 (responsiveness), "자원을 더 확보할 때마다 처리할 수 있는 작업량이 늘어나는 정도"를 의미하는 확장성 (scalability)

안전성 테스트는 문제가 발생할 확률을 높게 만들어야 한다. 확률이 높아지려면 교차 실행(interleaving) 회수를 늘리면 된다. 하드웨어 (CPU) 개수 보다 스레드 개수가 많을수록 교차 실행 회수가 늘어난다. 사용할 수 있는 테스트 기법으로 `Thread.yield()` 를 사용하는 방법이 있다. JVM 구현체에 따라 의도대로 동작하지 않을 수 있으므로 `Thread.sleep()` 을 사용해도 된다. AOP를 사용하면 프로덕션 코드에 영향을 최소화하면서 `Thread.yield()` 를 활용할 수 있다. 

병렬 환경에서 주의해야 하는 점이 하나 더 있다. 사용하지 말아야할 자원을 사용하는 지 확인해야 한다. 테스트 대상 (sut) 실행 전후로 자원 사용량의 스냅샷을 만들어 확인하여 예방할 수 있다.

예외적으로 안전성 테스트하기 어려운 상황이 있다. 캐싱을 테스트하는 경우 컴파일러에서 최적화하여 미리 계산할 수도 있다. 문제를 예방하려면 데이터가 임의성 (randomness)를 가지도록 설정해야 한다.

다음에는 활동성 테스트에 대해 정리해볼 예정이다.
