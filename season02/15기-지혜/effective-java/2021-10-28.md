### 아이템 45. 스트림은 주의해서 사용하라

스트림 API가 제공하는 추상 개념 중 핵심은 두 가지다. 그 첫번째인 스트림(stream)은 데이터 원소의 유한 혹은 무한 시퀀스(sequence)를 뜻한다. 두 번째인 스트림 파이프라인(stream pipelime)은 이 원소들로 수행하는 연산 단계를 포함하는 개념이다.

스트림 파이프라인은 소스 스트림에서 시작해 종단 연산으로 끝나며, 그 사이에 하나 이상의 중간 연산이 있을 수 있다. 각 중간 연산은 스트림을 어떠한 방식으로 변환 한다. 

스트림 파이프라인은 지연 평가(lazy evaluation)된다. 평가는 종단연산이 호출될 때 이뤄지며, 종단 연산에 쓰이지 않는 데이터 원소는 계산에 쓰이지 않는다.

스트림을 과용하면 프로그램이 읽거나 유지보수하기 어려워진다.

char 값들을 처리할 때는 스트림을 삼가는 편이 낫다.

스트림과 반복문을 적절히 조합하는게 최선이다. 그러니 기존 코드는 스트림을 사용하도록 리팩터링하되, 새 코드가 더 나아 보일 때만 반영하자.

스트림 파이프라인은 되풀이되는 계산을 함수 객체(주로 람다나 메서드 참조)로 표현한다. 반면 반복 코드에서는 코드 블록을 사용해 표현한다.

코드 블록에서는 범위 안의 지역 변수를 읽고 수정할 수 있다. 하지만 람다에서는 final이거나 사실상 final인  변수만 읽을 수 있고, 지역변수를 수정하는 건 불가능하다.

코드 블록에서는 return문을 사용해 메서드에서 빠져나가거나, break나 countinue 문으로 블록 바깥의 반복문을 종료하거나 반복을 한 번 건너뛸 수 있다. 또한 메서드 선언에 명시된 검사 예외를 던질 수 있다. 하지만 람다로는 이 중 어떤 것도 할 수 없다.

스트림으로 처리하기 어려운 일도 있다. 한 데이터가 파이프라인의 여러 단계(stage)를 통과할 때 이 데이터의 각 단계에서의 값들에 동시에 접근하기는 어려운 경우다. 스트림 파이프라인은 일단 한 값을 다른 값에 매핑하고 나면 원래의 값은 잃는 구조이기 때문이다.

### 아이템 46. 스트림에서는 부작용 없는 함수를 사용하라

스트림 패러다임의 핵심은 계산을 일련의 변화(transformation)으로 재구성 하는 부분이다. 이때 각 변화 단계는 가능한 한 이전 단계의 결과를 받아 처리하는 순수 함수여야 한다. 순수 함수란 오직 입력만이 결과에 영향을 주는 함수를 말한다. 달느 가변 상태를 참조하지 않고, 함수 스스로도 다른 상태를 변경하지 않는다. 이렇게 하려면 스트림 연산에 건네는 함수 객체는 모두 부작용(side effect)이 없어야 한다.

forEach연산은 스트림 계산 결과를 보고할 때만 사용하고, 계산하는데는 쓰지말자.
