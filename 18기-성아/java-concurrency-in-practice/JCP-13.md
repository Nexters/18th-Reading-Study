## 스레드 풀 설정 값

- 코어 크기
    - 실행할 작업이 없더라도 스레드 개수를 최대 코어 크기에 맞추도록 되어 있다
    - 시작부터 코어 크기로 고정되는 것이 아니라 작업이 실행되면서 코어 크기까지 스레드가 생성된다.
    - 큐에 작업이 가득차지 않는 한 스레드 수가 코어 크기를 넘지 않는다.
- 최대 크기
    - 동시에 얼마나 많은 개수의 스레드가 동작할 수 있는지 제한하는 최대값.
        - 코어 크기 10, 최대 크기 20. 작업 큐 크기 2일 경우, 15개 작업이 들어오면 13개만 생성...
- 스레드 유지 시간 (keep-alive)

## 스레드 풀 사용 전략

- 스레드 풀을 사용하더라도 애플리케이션에 부하가 많이 걸리는 경우 자원을 모두 잡아먹는 상태가 될 수 있다.
- 스레드 풀에서 작업을 쌓아둘 큐에 적용할 수 있는 전략
    - 큐에 크기 제한을 두지 않는다.
    - 큐의 크기를 제한한다.
    - 스레드에게 직접 작업을 넘겨준다.
- 스레드의 개수를 줄이고 큐의 크기를 늘린다.
    - 메모리와 CPU사용량을 줄이고 컨텍스트 스위칭 회수를 줄인다. -> 성능이 저하된다.
- 작업 큐로 SynchronousQueue를 사용하면 작업을 큐에 저장하지 않고 스레드에 직접 넘겨준다.
    - 스레드 개수가 최대 크기에 다다르면 집중 대응 정책 (saturation policy) 에 따라 작업을 거부한다.

### 집중 대응 정책

- ThreadPoolExecutor의 집중 대응 정책은 setRejectedExecutionHandler 메소드를 사용해 정책을 변경할 수 있다.
- 적용하는 경우
    - SynchronousQueue를 작업 큐로 사용할 때 최대 스레드인 상태에서 새로운 작업이 넘겨올 때
    - 작업 큐가 꽉 찬 경우
    - 종료된 스레드 풀에 작업을 등록할 때
- 종류
    - 중단 (abort)
        - RejectedExecutionException을 던진다.
    - 제거 (discard)
        - 추가하려고 했던 작업을 제거 한다.
    - 오래된 항목 제거 (discard oldest)
        - 가장 오래된, 다음 실행될 예정이던 작업을 제거 한다.
    - 호출자 실행 (caller runs)
        - 큐의 크기가 초과하는 작업을 프로듀서에서 실행해 작업 추가 속도를 늦춘다.
    - 응용
        - 작업 추가를 대기하도록 하는 전략은 없다. 하지만 Semaphore를 응용하면 구현할 수 있다.
