6장. 입출력과 네트워킹 - 컴퓨터는 외부와 어떻게 상호작용하는가



출력을 위한 래치, 입력을 위한 트라이스테이트 버퍼. 이 두 가지와 I/O장치의 핀이 연결되고 CPU가 이 모든 연결을 직접 조작하던 때도 있었다.

샘플링: 아날로그 데이터를 컴퓨터가 쓸 수 있는 디지털 형태로 바꾸는 것, 혹은 그 역방향



- 저수준 I/O

I/O 포트에서

DDR: 데이터 방향 레지스터 - 입력(0)이거나 출력(1)임을 결정한다.

PORT: 출력 데이터 저장 래치



버튼 누르기

pull-up 저항

버튼이 눌리지 않은 경우, 저항이 프로세서의 인터럽트 요청(IRQ) 핀에 연결된 선의 전압을 끌어올려 논리를 HIGH로 만듦

버튼이 눌린 경우, 회로나 IRQ가 타지 않게 전류를 제한하여 논리를 LOW로 만듦

이때 접촉면이 불안정해 인터럽트가 여러번 발생하는 것을 바운스라고 한다.



디바운스

유한 임펄스 응답(큐)에 새 값을 넣으면서 값을 시프트하고, 배열 원소의 OR값으로 상태를 만든다. current를 입력으로 넣고, 기존 current는 previous로 옮긴다. 두 값을 XOR하면 어떤 버튼 상태가 바뀌었는지 알 수 있다.



빛이 있으라

각각의 led에 전기를 연결하지 않고, led를 모두 연결하여 핀 하나로 전기를 연결하여 제어한다. 공통 캐소드이다. 모든 캐소드가 한꺼번에 연결되고, 각 애노드마다 별도의 핀이 배정된다.

애노드를 프로세서의 출력 핀에 연결하고, 캐소드를 0에 연결한다. 실전에서는 대부분 충분한 전류를 제공하기 위하여 추가로 드라이버 회로를 구성해야 한다. 이런 목적으로 종종 오픈 컬렉터가 쓰인다.

보통 디스플레이를 하나만 사용하는 경우는 드물다. 디스플레이의 애노드를 포트 A에 연결하고, 캐소드를 B에 연결해서 디스플레이를 멀티플렉스 한다. 디스플레이 애노드는 병렬로 연결되고(모든 A끼리, B끼리), 캐소드는 자신만의 출력 핀에 연결된다. 어떤 세그먼트가 켜지려면 해당 디스플레이의 애노드가 1, 캐소드가 0이어야 한다. 전류가 출력 핀으로 들어와서 해당 세그먼트 핀쪽으로 흐른다.

이 디스플레이가 작동하게 하기 위해 사람의 시각의 잔상효과를 활용한다. 우리 눈과 두뇌는 1/24초보다 짧은 간격으로 깜빡거리는 경우 빛이 켜져있는 것으로 인식한다.



그레이의 2^n가지 그림자

센서를 읽어서 회전축의 위치를 알아내야 하는 경우가 종종 있다. 이때 전파 지연으로 인해 문제가 생길 경우를 대비하여 프랭크 그레이가 그레이 코드를 만들었다. 각도가 달라질 때 비트가 하나씩만 달라지는 인코딩 방법이다. 



쿼드러처

그레이 코드를 통해 어떤 대상의 위치가 변했는지, 어떤 방향으로 변했는지를 알 수 있다. 이러한 변형에는 네 가지 상태가 존재하기 때문에 이를 쿼드러처 인코딩이라고 부른다. 쿼드러처에서는 2비트 그레이 코드 패턴이 여러 번 반복된다.



병렬 통신

포트 B에 여덟 가지 LED를 연결하고 아스키코드를 발광하게 할 수 있다. 포트에 데이터를 전송할 때 데이터가 올바르게 들어 있는 순간을 알 수 있는 스트로브 신호를 보낸다. 스트로브가 0일때 데이터가 유효하다.

병렬 인터페이스는 선이 많이 필요해서 가격이 비싸다. 한 선에 전달될 수 있는 신호의 속도에는 한계가 있다.



직렬 통신

선을 덜 쓰고 통신할 수 있으면 더 좋다. 한 선에 어떻게 신호를 8개 보낼 수 있을까? 각 비트는 서로 다른 선을 통해 전송되지만, 각 문자는 서로 다른 시간에 나뉘어 전송된다. 비트도 서로 다른 시간에 보낼 수 있다.

송신하는 쪽에서는 스트로브(또는 클록) 신호가 각 비트를 한 위치씩 시프트시키면서 밀려 나가는 비트를 내보낸다. 수신하는 쪽에서는 클록이 비트를 한 위치씩 시프트시키면서 빈 자리에 받은 비트를 채워 넣는다. 송신자와 수신자가 서로 동기화돼야한다.

반이중 통신에서는 송신자와 수신자가 같은 선을 공유한다. 무전기

전이중 통신은 선이 2개여서 각기 다른 방향으로 동시에 통신이 가능하다.

나중에는 이런 통신을 가능하게 해 주는 회로가 한 IC로 만들어졌는데, 이를 UART라고 한다. (범용 비동기 수신기-송신기) 소프트웨어로 구현하는 건 비트 뱅잉이라고 부른다.



파동에 올라타라

마크-스페이스 방식(시작 비트와 정지 비트를 붙여 보내는 방식)은 장거리 통신에 적합하지 않다.

전달하려는 신호를 바탕으로 반송파(캐리어)를 마크-스페이스 파형으로 변조하고 싶다. Bell 103A는 네 가지 음향 주파수를 사용하며 전화선을 통해 전달되는 300보Baud의 전이중 통신을 제공한다. 마크-스페이스에 의해 주파수가 시프트되기 때문에 주파수 편이 변조FSK라고 부른다. 받는 쪽에서는 다시 마크-스페이스로 되돌리는 복조를 수행한다. 모뎀. 잡음이 발생한다.



범용 직렬 버스

USB에는 모든 종단점을 담당하는 컨트롤러가 존재한다. 데이터 전송은 구조화되어 있다. 데이터는 패킷으로 나뉜다. 패킷에는 헤더와 페이로드가 들어있다. 종단점은 데이터 전송을 보장하기 위해 자신이 원하는 대역폭을 예약해달라고 요청할 수 있다. 충분한 대역폭이 없는 경우 컨트롤러는 이런 요청을 거부할 수 있다.