6장. 입출력과 네트워킹 - 컴퓨터는 외부와 어떻게 상호작용하는가



출력을 위한 래치, 입력을 위한 트라이스테이트 버퍼. 이 두 가지와 I/O장치의 핀이 연결되고 CPU가 이 모든 연결을 직접 조작하던 때도 있었다.

샘플링: 아날로그 데이터를 컴퓨터가 쓸 수 있는 디지털 형태로 바꾸는 것, 혹은 그 역방향



- 저수준 I/O

I/O 포트에서

DDR: 데이터 방향 레지스터 - 입력(0)이거나 출력(1)임을 결정한다.

PORT: 출력 데이터 저장 래치



버튼 누르기

pull-up 저항

버튼이 눌리지 않은 경우, 저항이 프로세서의 인터럽트 요청(IRQ) 핀에 연결된 선의 전압을 끌어올려 논리를 HIGH로 만듦

버튼이 눌린 경우, 회로나 IRQ가 타지 않게 전류를 제한하여 논리를 LOW로 만듦

이때 접촉면이 불안정해 인터럽트가 여러번 발생하는 것을 바운스라고 한다.



디바운스

유한 임펄스 응답(큐)에 새 값을 넣으면서 값을 시프트하고, 배열 원소의 OR값으로 상태를 만든다. current를 입력으로 넣고, 기존 current는 previous로 옮긴다. 두 값을 XOR하면 어떤 버튼 상태가 바뀌었는지 알 수 있다.



빛이 있으라

각각의 led에 전기를 연결하지 않고, led를 모두 연결하여 핀 하나로 전기를 연결하여 제어한다. 공통 캐소드이다. 모든 캐소드가 한꺼번에 연결되고, 각 애노드마다 별도의 핀이 배정된다.

애노드를 프로세서의 출력 핀에 연결하고, 캐소드를 0에 연결한다. 실전에서는 대부분 충분한 전류를 제공하기 위하여 추가로 드라이버 회로를 구성해야 한다. 이런 목적으로 종종 오픈 컬렉터가 쓰인다.

보통 디스플레이를 하나만 사용하는 경우는 드물다. 디스플레이의 애노드를 포트 A에 연결하고, 캐소드를 B에 연결해서 디스플레이를 멀티플렉스 한다. 디스플레이 애노드는 병렬로 연결되고(모든 A끼리, B끼리), 캐소드는 자신만의 출력 핀에 연결된다. 어떤 세그먼트가 켜지려면 해당 디스플레이의 애노드가 1, 캐소드가 0이어야 한다. 전류가 출력 핀으로 들어와서 해당 세그먼트 핀쪽으로 흐른다.

이 디스플레이가 작동하게 하기 위해 사람의 시각의 잔상효과를 활용한다. 우리 눈과 두뇌는 1/24초보다 짧은 간격으로 깜빡거리는 경우 빛이 켜져있는 것으로 인식한다.



그레이의 2^n가지 그림자

센서를 읽어서 회전축의 위치를 알아내야 하는 경우가 종종 있다. 이때 전파 지연으로 인해 문제가 생길 경우를 대비하여 프랭크 그레이가 그레이 코드를 만들었다. 각도가 달라질 때 비트가 하나씩만 달라지는 인코딩 방법이다. 



쿼드러처

그레이 코드를 통해 어떤 대상의 위치가 변했는지, 어떤 방향으로 변했는지를 알 수 있다. 이러한 변형에는 네 가지 상태가 존재하기 때문에 이를 쿼드러처 인코딩이라고 부른다. 쿼드러처에서는 2비트 그레이 코드 패턴이 여러 번 반복된다.



병렬 통신

포트 B에 여덟 가지 LED를 연결하고 아스키코드를 발광하게 할 수 있다. 포트에 데이터를 전송할 때 데이터가 올바르게 들어 있는 순간을 알 수 있는 스트로브 신호를 보낸다. 스트로브가 0일때 데이터가 유효하다.

병렬 인터페이스는 선이 많이 필요해서 가격이 비싸다. 한 선에 전달될 수 있는 신호의 속도에는 한계가 있다.



직렬 통신

선을 덜 쓰고 통신할 수 있으면 더 좋다. 한 선에 어떻게 신호를 8개 보낼 수 있을까? 각 비트는 서로 다른 선을 통해 전송되지만, 각 문자는 서로 다른 시간에 나뉘어 전송된다. 비트도 서로 다른 시간에 보낼 수 있다.

송신하는 쪽에서는 스트로브(또는 클록) 신호가 각 비트를 한 위치씩 시프트시키면서 밀려 나가는 비트를 내보낸다. 수신하는 쪽에서는 클록이 비트를 한 위치씩 시프트시키면서 빈 자리에 받은 비트를 채워 넣는다. 송신자와 수신자가 서로 동기화돼야한다.

반이중 통신에서는 송신자와 수신자가 같은 선을 공유한다. 무전기

전이중 통신은 선이 2개여서 각기 다른 방향으로 동시에 통신이 가능하다.

나중에는 이런 통신을 가능하게 해 주는 회로가 한 IC로 만들어졌는데, 이를 UART라고 한다. (범용 비동기 수신기-송신기) 소프트웨어로 구현하는 건 비트 뱅잉이라고 부른다.



파동에 올라타라

마크-스페이스 방식(시작 비트와 정지 비트를 붙여 보내는 방식)은 장거리 통신에 적합하지 않다.

전달하려는 신호를 바탕으로 반송파(캐리어)를 마크-스페이스 파형으로 변조하고 싶다. Bell 103A는 네 가지 음향 주파수를 사용하며 전화선을 통해 전달되는 300보Baud의 전이중 통신을 제공한다. 마크-스페이스에 의해 주파수가 시프트되기 때문에 주파수 편이 변조FSK라고 부른다. 받는 쪽에서는 다시 마크-스페이스로 되돌리는 복조를 수행한다. 모뎀. 잡음이 발생한다.



범용 직렬 버스

USB에는 모든 종단점을 담당하는 컨트롤러가 존재한다. 데이터 전송은 구조화되어 있다. 데이터는 패킷으로 나뉜다. 패킷에는 헤더와 페이로드가 들어있다. 종단점은 데이터 전송을 보장하기 위해 자신이 원하는 대역폭을 예약해달라고 요청할 수 있다. 충분한 대역폭이 없는 경우 컨트롤러는 이런 요청을 거부할 수 있다.



- 네트워킹

최초의 네트워크는 전신 -> 전화로 발전했다. 전화는 회선 교환 방식의 네트워크다. 이는 전선이 실제로 연결되어 회로를 만드는 것을 말한다. 교환 방식이란 통화가 이뤄지는 동안만 회선이 만들어지는 것을 말한다.

현재의 전화 시스템은 패킷 교환 방식을 사용한다. 통신 내용은 송수신자의 주소가 포함된 패킷으로 나뉜다. 시간 분할 멀티플렉싱을 사용하면 같은 전선을 공유하면서 패킷을 보낼 수 있기 때문에 회로를 더 효율적으로 사용할 수 있다.



최근의 LAN들

이더넷은 먼 거리를 연결할 수 있는 방식은 아니고 LAN이다. 최초의 이더넷은 반이중 시스템이었다. 모든 장치가 같은 선에 연결됐다. 각 장치의 네트워크 인터페이스에는 MAC 주소가 부여됐다. 요즘의 이더넷은 라우터라는 장치에 연결되며, 라우터는 어떤 장치가 어떤 선에 연결되어 있는지를 기억하고 패킷을 정확히 배달해준다.



인터넷

여러 계층으로 이뤄진 프로토콜의 집합이다. 아래쪽 계층을 변경해도 위쪽 계층에 영향을 끼치지 않는다.



TCP/IP

인터넷이 사용하는 두 가지 프로토콜이다. 패킷을 옮겨준다. IP는 배달원, TCP는 택배사와 비슷하다.



IP 주소

각 컴퓨터에는 유일한 IP 주소가 할당된다. MAC과 달리 IP는 변경될 수 있다.



도메인 이름 시스템

IP 주소가 바뀌므로 어떤 장치의 현재 실제 주소를 찾을 때 DNS를 사용한다. 전화번호부와 비슷하다.



월드 와이드 웹

SMTP, HTTP. HTTP 표준은 웹 브라우저가 웹 서버와 상호작용하는 방법을 정의한다. 웹 브라우저는 웹 페이지를 볼 때 사용하는 프로그램이다. 웹 서버는 요청한 페이지를 제공한다. URL을 입력하여 웹 페이지를 얻는다.



- 아날로그 처리 방법

우리가 실제로 겪는 소리나 빛은 연속적이지만 컴퓨터에는 연속적인 대상을 저장할 방법이 없다. 그래서 데이터의 샘플을 취해야 한다. 샘플링은 시간이나 공간상 일정한 간격으로 값을 읽어야 한다는 뜻이다. 저장한 데이터를 다시 영상이나 빛으로 보여주려면 샘플링 데이터로부터 아날로그 신호를 다시 만들어내야 한다.



디지털을 아날로그로 변환

DA(D/A, DAC)변환기. 전압을 만들어낸다. 해상도라는 용어는 DAC가 만들어내는 단계 수를 느슨히 표현할 때 쓰인다. DAC가 10비트 해상도라고 하면, 실제로는 1/2^10가지씩 수준을 변경할 수 있다는 뜻이다. 해상도는 DAC가 만들어낼 수 있는 최대 전압을 단계 수로 나눈 값이어야 한다.

DAC를 사용해 아날로그 파형을 만들 수 있다. 오디오 플레이어나 음악 신디사이저가 이런 식으로 작동한다. DAC 입력을 일정한 비율로 변경하면 파형을 만들 수 있다. 8비트 DAC를 포트 B에 연결하면 톱니 파형을 만들 수 있다. 더 복잡한 파형을 만들기 위한 장치는 추가 회로를 통해 메모리에 있는 데이터를 읽는다.

높은 워터마크와 낮은 워터마크는 최고수위선과 최저수위선에서 따온 용어다. 낮은 워터마크는 FIFO가 거의 빈 상태가 될 경우 인터럽트를 발생시킨다. 높은 워터마크는 FIFO가 거의 꽉 찼을 때 인터럽트를 발생시킨다. 고수준의 소프트웨어에서는 일정한 비율로 연속적으로 출력이 일어나도록 메모리를 채울 수 있다.



아날로그를 디지털로 변환

AD(A/D, ADC)변환기. 값을 측정할 수 있도록 아날로그 신호의 현재 값을 흔들리지 않게 안정적으로 잡아내는 것이 어렵다. 샘플 앤드 홀드라는 회로를 사용해 아날로그 파형의 값을 잡아낼 수 있다.

스위치를 닫아서 샘플을 얻으면 아날로그 신호의 현재 값이 저장 탱크에 저장된다. 저장 탱크에서 나온 샘플값을 DAC의 값과 비교한다. 샘플값과 DAC값이 같아지면 비교기의 출력이 0이 되면서 카운터가 비활성화되므로 원하는 값을 얻는다. (그림6-29)

DAC 출력이 마치 경사로를 올라가는 것처럼 변하기 때문에 이런 ADC를 램프 변환기라고 부른다. 문제는 신호에서 얻은 샘플의 크기에 선형으로 비례하는 시간이 걸려, 오랜 시간이 걸린다.

이를 우회하는 방법으로 연속 추정 변환기가 있다. 이는 하드웨어로 2진 검색을 진행한다.



디지털 오디오

일차원으로 샘플링을 하면 오디오를 디지털화할 수 있다. 일정 시간 간격으로 신호의 진폭이나 높이를 측정한다.

어떤 코드는 각 음들이 만들어내는 사인파의 가중치 합으로 표현할 수 있다. 푸리에 변환을 통해 이 코드의 각 음을 구분할 수 있다.

미디어 플레이어의 기능으로 그래픽 이퀄라이저도 있다. 조절 가능한 필터의 집합이다. 필터는 정해진 주파수를 통과시키거나 막아버리는 장치를 뜻한다. 로우패스, 하이패스. 이 둘을 조합하면 최저 주파수와 최고 주파수 사이의 주파수를 제외한 나머지를 모두 무시하는 밴드패스나 특정 주파수만 제외시키는 노치를 만들 수 있다. 