7장. 데이터 구조와 처리 - 어떻게 해야 프로그램에서 데이터를 잘 구성하고 처리할까



데이터 구조: 데이터를 조직화하는 표준적인 방법. 데이터 구조 중 상당수는 여러 유형의 메모리를 더 효율적으로 사용하기 위해 존재한다.

참조 지역성: 필요한 데이터를 메모리에서 서로 근처에 유지하고, 금방 사용할 데이터라면 더 가까운 곳에 저장하라는 의미



- 기본 데이터 타입

포인터를 잘못 사용하고 이 코드를 새로 등장한 아키텍처로 포팅하면 프로그램이 깨지고 종종 디버깅하기 어려운 방식으로 잘못되는 경우가 있다. 이를 해결하기 위해 사람들은 이식성에 관심을 기울이기 시작했다. 또는 자바처럼 포인터를 없앤 언어를 만들었다.



- 배열

배열을 바라보는 다른 관점은 상대 주소 지정이라는 렌즈를 통하는 것이다. 각 원소는 기저 주소로부터 얼마나 멀리 떨어져 있는지 오프셋으로 나타낸다.



- 비트맵

비트맵에 대해 수행할 수 있는 기본 연산은 네가지, 그 연산 방법은

set 비트 설정하기(1로 만들기): 비트들 = 비트들 OR 마스크,

clear 비트 지우기(0으로 만들기): 비트들 = 비트들 AND (NOT 마스크),

비트가 1인지 검사하기: 비트들 AND 마스크 = not 0,

비트가 0인지 검사하기: 비트들 AND 마스크 = 0



- 문자열

문자열 길이를 추적할 가장 편한 방법은 문자열 데이터 안에 문자열 길이를 어찌어찌 넣는 것이다.



- 복합 데이터 타입

구조체: 편의 문법



- 단일 연결 리스트

목록에 들어갈 원소 개수를 모르는 경우 유용하다. 구조체를 사용해 만들 수 있다.



- 동적 메모리 할당

정적으로 할당된 데이터 영역 다음에 프로그램 런타임 라이브러리가 설정해주는 힙 영역이 있다. 별도의 메모리 관리 유닛(MMU)이 없는 컴퓨터라면 이 힙 영역이 프로그램에 사용할 수 있는 모든 데이터 메모리다.

배열 등의 변수가 사용하는 메모리는 정적이다. 리스트 노드와 같은 존재는 동적이다. 동적인 대상에 사용할 메모리를 힙에서 얻는다.

프로그램은 힙을 관리할 수 있어야 한다. C에는 malloc과 free 함수가 있다.

malloc  구현 중에는 단일 연결 리스트 데이터 구조를 사용해 작동하는 구현이 있다. 힙은 여러 블록으로 나뉘고, 각 블록에는 크기와 다음 블록에 대한 포인터가 포함된다.

프로그램이 메모리를 요청하면 malloc이 충분한 크기의 블록을 찾아서 요청받은 공간에 대한 포인터를 돌려준다. free로 메모리를 해제하면 메모리가 다시 연결 리스트에 추가된다.



- 더 효율적인 메모리 할당

노드에 문자열을 가리키는 포인터가 포함된 연결 리스트가 있다. 이런 경우 노드와 문자열을 동시에 할당하면 부가 비용을 줄일 수 있다. 이는 노드를 삭제할 때도 더 효율적이다.



- 가비지 컬렉션

자바나 자바스크립트 같은 언어에는 포인터가 없지만 직접 malloc이나 free를 하지 않으면서도 동적 메모리 할당을 지원한다. 대신에 가비지컬렉션을 구현한다.

포인터 대신 참조를 사용한다. 참조는 포인터를 추상화해서 거의 비슷한 기능을 제공하지만 실제 메모리 주소를 노출하지는 않는다.

가비지 컬렉션의 트레이드 오프는, 프로그래머가 가비지 컬렉션 시스템을 제어할 수 없다는 점이다. 이로 인해 프로그램이 아주 중요한 일을 하는 도중에 가비지 컬렉션 시스템이 작동돼서 문제가 생기는 경우도 있다.



- 이중 연결 리스트

단일 연결 리스트처럼 노드에 다음 원소에 대한 포인터뿐만 아니라 이전 원소에 대한 포인터도 들어 있다. 이중 연결 리스트에서 노드 삭제나 삽입 연산을 할 때는 리스트를 순회할 필요가 없다.



- 대용량 저장장치

디스크의 기본 단위는 블록, 연속적인 블록은 클러스터라고 부른다.

어떤 데이터를 저장하기 위한 저장소 블록을 찾는 대신, 어떤 데이터를 저장하기에 충분한 크기가 되도록 고정된 크기의 블록을 여럿 확보해서 데이터를 나눠 담아야 한다.

파일 이름이 필요하고, 이름과 데이터가 담긴 디스크 블록을 연결해줄 방법이 필요하다. 유닉스에서 블록 중 일부를 아이노드(인덱스+노드)로 따로 지정한다. 아이노드에는 직접 블록 포인터가 12개 있다. 직접 블록을 통해서 49,152바이트까지 데이터를 보관할 수 있다. 파일이 더 커지면 간접 블록을 사용한다. 

아이노드 정보 중에는 블록에 데이터가 있는지 디렉터리 정보가 있는지를 표시하는 것도 있다. 계층적 파일 시스템.

여러 아이노드가 같은 블록을 참조할 수 있다. 각 참조를 링크라고 부른다. 디렉터리에 링크를 하면 편리하다는 사실을 통해 심볼릭 링크가 생겨났다. 하지만 이로 인해 시스템 그래프에 루프가 생겨 무한루프를 감지하기 위한 특별한 코드가 필요하다.

가용 공간을 추적하는 효율적인 방법으로 각 블록을 1비트로 표현하는 비트맵을 사용한 방식을 들 수 있다. 하지만 파일 시스템 그래프와 가용 공간을 나타내는 비트맵 사이에 동기화가 깨질 수 있다는 문제가 있다. 



- 데이터베이스