### 4) 확인응답 지연

- **각 TCP 세그먼트는 순번과 데이터 무결성 checksum을 가진다.**
- 세그먼트 수신자는 세그먼트를 온전히 받으면 ACK 패킷을 반환한다. 송신자가 특정 시간 안에 ACK을 받지 못하면 패킷이 파기되었거나 오류가 있는 것으로 판단하고 데이터를 다시 전송한다.
- ACK은 크기가 작으므로 같은 방향으로 송출되는 **데이터 패킷에 편승(piggyback)시킨다.** 이런 경우를 늘리기 위해 `확인응답 지연 알고리즘`을 구현한다. 특정 시간 동안 버퍼에 ACK을 저장해두고 piggyback이 가능한 송출 데이터 패킷을 찾는다. 만약 찾지 못하면 ACK은 별도 패킷을 만들어 전송한다.
- HTTP 동작방식은 piggyback을 하기 어려우므로 확인응답 지연 알고리즘으로 인한 딜레이가 자주 발생한다. 운영체제에 따라 다르지만, 지연의 원인이 되는 확인응답 지연관련 기능을 수정하거나 비활성화 할 수 있다.

### 5) TCP 느린 시작 (slow start)

- TCP 커넥션은 자체적으로 튜닝되므로 처음에는 커넥션의 최대 속도를 제한하고 데이터가 성공적으로 전송됨에 따라 속도 제한을 높여나간다. -> `TCP slow start` (혼잡제어)
- 새로운 커넥션은 '튜닝'된 커넥션보다 느리므로 HTTP에는 이미 존재하는 커넥션을 재사용하는 기능이 있다.

### 6) 네이글(Nagle) 알고리즘과 TCP_NODELAY
>  1바이트 크기의 패킷을 대량으로 전송하는 것을 '실리 윈도 증후군 전송자'라 한다.

- TCP는 데이터 스트림 인터페이스를 제공한다. 각 TCP 세그먼트는 40바이트 상당의 플래그와 헤더를 포함하므로 **TCP가 작은 크기의 데이터를 포함한 경우 네트워크 성능은 크게 떨어진다.**
- `네이글 알고리즘`은 네트워크 효율을 위해 패킷을 전송하기 전에 많은 양의 TCP 데이터를 한 개의 덩어리로 합친다. (RFC896)
- 네이글 알고리즘은 HTTP 성능 관련해 여러 문제를 발생시킨다.
    1. 크기가 작은 HTTP 메시지는 패킷을 채우지 못하므로 추가적인 데이터를 기다리며 지연된다.
    2. ACK 지연과 함께 쓰이는 경우 형편없이 동작한다.
- HTTP 애플리케이션은 성능 향상을 위해 TCP_NODELAY 파라미터 값을 설정하여 네이글 알고리즘을 비활성화한다.

### 7) TIME_WAIT의 누적과 포트 고갈

`TIME_WAIT` 포트 고갈은 성능 측정 시 심각한 성능 저하를 발생시키지만, 보통 실제 상황에서는 문제를 발생시키지 않는다.
- TCP 커넥션의 종단에서 TCP 커넥션을 끊으면 종단에서는 커넥션의 IP 주소와 포트번호를 메모리의 작은 제어영역에 기록한다. 같은 주소와 포트번호를 사용하는 새로운 TCP 커넥션이 일정 시간동안 생성되지 않게 하기 위함이다.

## 4.3 HTTP 커넥션 관리

### 2) 순차적인 트랜잭션 처리에 의한 지연

- 순차적인 처리로 인한 지연에는 하나의 이미지를 내려받는 중에 나머지 웹 페이지 공간에 아무런 변화가 없어서 느껴지는 심리적 지연도 있다.
- 순차적 로드 방식의 또 하나의 단점은 특정 브라우저의 경우 객체를 화면에 배치하려면 객체의 크기를 알아야 하기 때문에 모든 객체를 내려받기 전까지는 텅 빈 화면을 보여준다는 것이다.

## 4.4 병렬 커넥션

- HTTP는 클라이언트가 여러 개의 커넥션을 맺음으로써 여러 개의 HTTP 트랜잭션을 병렬로 처리할 수 있게 한다.

### 1) 병렬 커넥션을 페이지를 더 빠르게 내려받는다

- 각 커넥션의 지연 시간을 겹치게 하면 총 지연 시간을 줄일 수 있고, 클라이언트의 인터넷 대역폭을 한 개의 커넥션이 다 써버리는 것이 아니라면 나머지 객체를 내려받는 데에 남은 대역폭을 사용할 수 있다.

### 2) 병렬 커넥션이 항상 더 빠르지는 않다.

- 클라이언트 네트워크 대역폭이 좁을 때 병렬로 내려받는 경우 성능상의 장점은 거의 없어진다.
- 다수의 커넥션은 메모리를 많이 소모하고 자체적인 성능 문제를 발생시킨다.
- 브라우저는 실제 병렬 커넥션을 사용하긴 하지만 적은 수의 병렬 커넥션만을 허용한다.